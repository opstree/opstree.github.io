import requests,json, yaml

out_file='Open_Source_output.yml'
d={}
source_yaml_data=input("Please Enter the source yaml file:")
category=input("Please enter category : ")

#To Load Input data in yml format
with open(source_yaml_data) as f:
    d=(json.dumps(yaml.load(f,Loader=yaml.FullLoader)))
dic1=json.loads(d)

#To fetch the Username from github url
for i in dic1[category]:
    github_username = i.partition("orgs/")[2]
    #print(github_username)

#api url to fetch github data
    api_url = f"https://api.github.com/users/{github_username}"

    #send get request
    response = requests.get(api_url)
    data =  response.json()

    repo_link = data["repos_url"]
    response_repo = requests.get(repo_link)
    #Convert the result into json format
    repo_data = response_repo.json()

    mydict={}
    l1=[]
  #create a empty dictionary and append the required data into the new dict
    for i in range (len(repo_data)):
        mydict=dict(Name=repo_data[i]["name"],
        description = (repo_data[i]["description"]),
        repo = (repo_data[i]["html_url"]))
        l1.append(mydict)

    yaml_data = ({
      'version': '1.0'
    })

    some_data = ({category: l1})
 #Write the yaml file with the required data
    with open(out_file,'w') as of:
        yaml.dump(yaml_data, of, default_flow_style=False, allow_unicode=True, encoding=None,line_break="\n")
        yaml.dump(some_data,of,default_flow_style=False,allow_unicode = True, encoding = None,line_break="\n")
    print(f"=======Yaml for User {github_username} has been generated=====")
